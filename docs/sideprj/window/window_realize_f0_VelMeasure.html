<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-sideprj/window/window_realize_f0_VelMeasure">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="alternate" type="application/rss+xml" href="/webpage/blog/rss.xml" title="Coding is my life... bravo my life... RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/webpage/blog/atom.xml" title="Coding is my life... bravo my life... Atom Feed"><title data-rh="true">속도측정 | Coding is my life... bravo my life...</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://github.com/webpage/docs/sideprj/window/window_realize_f0_VelMeasure"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="속도측정 | Coding is my life... bravo my life..."><meta data-rh="true" name="description" content="Since 21.08.20 ~ 21.11.30"><meta data-rh="true" property="og:description" content="Since 21.08.20 ~ 21.11.30"><link data-rh="true" rel="icon" href="/webpage/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://github.com/webpage/docs/sideprj/window/window_realize_f0_VelMeasure"><link data-rh="true" rel="alternate" href="https://github.com/webpage/docs/sideprj/window/window_realize_f0_VelMeasure" hreflang="en"><link data-rh="true" rel="alternate" href="https://github.com/webpage/docs/sideprj/window/window_realize_f0_VelMeasure" hreflang="x-default"><link rel="stylesheet" href="/webpage/assets/css/styles.2eee9628.css">
<link rel="preload" href="/webpage/assets/js/runtime~main.17ca84bd.js" as="script">
<link rel="preload" href="/webpage/assets/js/main.112632cd.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/webpage/"><div class="navbar__logo"><img src="/webpage/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/webpage/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">나는 개발자다!</b></a><a class="navbar__item navbar__link" href="/webpage/docs/mycareer">경력요약</a><a class="navbar__item navbar__link" href="/webpage/docs/introduce">자기소개</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/webpage/docs/sideprj">사이드프로젝트</a><a class="navbar__item navbar__link" href="/webpage/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/webpage/docs/sideprj">사이드프로젝트</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/webpage/docs/sideprj/temperature/temperature">온도제어 프로젝트</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/webpage/docs/sideprj/wiper">와이퍼 프로젝트</a><button aria-label="Toggle the collapsible sidebar category &#x27;와이퍼 프로젝트&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/webpage/docs/sideprj/window">윈도우 프로젝트</a><button aria-label="Toggle the collapsible sidebar category &#x27;윈도우 프로젝트&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/webpage/docs/sideprj/window/window_design">설계</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/webpage/docs/sideprj/window/realize">구현</a><button aria-label="Toggle the collapsible sidebar category &#x27;구현&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/webpage/docs/sideprj/window/window_realize_f0_PlantModeling">플랜트모델링</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/webpage/docs/sideprj/window/window_realize_f0_VelMeasure">속도측정</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/webpage/docs/sideprj/window/window_realize_f1_AutoManual">F1 AutoManual</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/webpage/docs/sideprj/window/window_realize_f2_Profiling">F2 Profiling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/webpage/docs/sideprj/window/window_realize_f3_FeedbackControl">F3 피드백제어</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/webpage/docs/sideprj/window/window_realize_f4_Initialize">F4 초기화</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/webpage/docs/sideprj/window/window_realize_f5_SoftStop">F5 Soft-Stop</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/webpage/docs/sideprj/window/window_realize_f6_AntiPinch">F6 Anti-Pinch</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/webpage/docs/sideprj/window/window_realize_f7_KalmanFilter">F7 칼만필터(Ing)</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/webpage/docs/sideprj/window/window_verify">검증</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/webpage/docs/sideprj/hybridprj">하이브리드 프로젝트</a><button aria-label="Toggle the collapsible sidebar category &#x27;하이브리드 프로젝트&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/webpage/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/webpage/docs/sideprj/window"><span itemprop="name">윈도우 프로젝트</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/webpage/docs/sideprj/window/realize"><span itemprop="name">구현</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">속도측정</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>속도측정</h1></header><div align="right"><font size="4">Since 21.08.20 ~ 21.11.30</font></div><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="속도측정">속도측정<a class="hash-link" href="#속도측정" title="Direct link to heading">​</a></h2><blockquote><p>Plant를 모델링을 위해 실제 시스템 입력(전압)에 따른 출력(각속도) 정보를 이용하여 System Identification을 수행하기 위해서는 속도를 측정할 수 있어야 한다.</p></blockquote><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><ul><li>복잡도를 낮추기 위해 모터 단품을 통해 Basic Logic 및 기본기능을 구현하고, 시뮬레이션을 통한 검증의 완료되면,</li><li>이후 Plant를 통해 시스템 의존적인(ex. anti-pinch) 기능을 구현하고 시뮬레이션을 통해 기능 검증을 수행한다.</li></ul></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dc모터-위치속도-측정-방법">DC모터 위치/속도 측정 방법<a class="hash-link" href="#dc모터-위치속도-측정-방법" title="Direct link to heading">​</a></h3><p>모터 전달함수를 구하기 위해서는 입력(모터 인가 전압)에 따른 출력(모터각속도)데이터를 이용하여 System Identification을 수행해야 한다.<br>
<!-- -->이를 위해 입력전압에 따른 출력속도 raw data를 측정할 수 있어야 한다.</p><p>HW-Simulink에서 구현한 시뮬링크 모델(<a href="/webpage/.">GPIO-ADC-PWM-QD-IC</a>를 통해 위치 및 속도를 측정한다.</p><p align="center"><img loading="lazy" src="/webpage/assets/images/mbd_hw_nxp_simulink_3_basic_ex-4eaadce86b8db5eacb3b1d8a98735c7d.png" alt="Example banner" width="350" class="img_ev3q"><br><em>&lt;nxp_s32k144_gpio_pwm_adc_qd_ic.slx&gt;</em></p><ul><li>SW2(dn) 입력 시 → +1 출력, +Rpm 측정, 펄스카운트 증가</li><li>SW2(up) 입력 시 → -1 출력, -Rpm 측정, 펄스카운트 감소</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="position-by-qd">Position by QD<a class="hash-link" href="#position-by-qd" title="Direct link to heading">​</a></h4><p>hall ic로부터 출력되는 펄스를 s32k144 quadrature decoder로 입력받아 위치를 카운트 한다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">    |￣￣|____|￣￣|____    // A상 2펄스 발생</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ↑    ↓    ↑    ↓</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       |￣￣|____|￣￣|____ // B상 2펄스 발생</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       ↑    ↓    ↑    ↓</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    1  2 3  4 5  6 7  8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>4극 Ring Magnet<ul><li>Motor Shaft 1회전 시 2펄스 발생 즉, 4번의 Edge(rising 2회, falling 2회)가 Detect 되며, A/B상이므로 2배가 되어 1회전 시 총 8<!-- -->[Count]<!-- -->가 발생하고,</li><li>Quadrature Phase Mode(4채배)로 rising/falling 모두 카운트 한다.</li></ul></li><li>기어비가 1:85인 윈도우 모터<ul><li>Shaft 1회전 시 8<!-- -->[Count]<!-- -->가 발생하고,</li><li>Gear 1회전 시 8x85=680<!-- -->[Count]<!-- -->가 발생한다.</li></ul></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="velocity-by-pulse-period">Velocity by Pulse Period<a class="hash-link" href="#velocity-by-pulse-period" title="Direct link to heading">​</a></h4><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</h5></div><div class="admonition-content"><ul><li>Zero Velocity<br>Capture Input 인터럽트를 통해 1펄스 시간을 측정하여 속도를 계산하는 방법은 정지상태에서는 펄스가 발생하지 않아 인터럽트가 실행되지 않기 때문에 Zero Velocity 측정불가 문제가 발생하는 한편,<br>일정 시간동안 발생되는 펄스수를 통해 속도를 계산하면 Zero Velocity를 계산할 수 있으나, 저속에서 펄스가 길어져 일정시간 안에 펄스가 발생되지 않아 측정 가능한 최소속도가 제한되는 문제가 발생한다.
100ms 단위로 측정되는 펄스 개수를 측정하여 속도를 계산한다.</li><li>정지상태 속도<br>처음 정지상태에서는 펄스주기가 측정되지 않기 때문에 1펄스 시간이 0으로 나오고, 0으로 나누면 무한대의 속도가 계산되는 현상이 발생한다. 따라서 정지상태에서는 속도계산을 수행하지 않고, 바로 Zero Velocity를 출력하고, 펄스주기가 측정될 때(이동중)에만 속도계산을 수행해야 한다.</li><li>ExtInt Premmption<br>ExtInt를 통한 펄스 주기 측정 시 우선순위가 높은 인터럽트에 의해 선점당하면 펄스주기가 큰 값으로 측정되어 속도값이 튀는 원인이 될 수 있으므로, ExtInt의 우선순위를 가장 높게 설정해야 한다.</li></ul></div></div><p>12<!-- -->[V]<!-- -->인가 시 Gear 75<!-- -->[rpm]<!-- -->이 측정되므로 Motor Shaft 속도는 다음과 같다.<br>
<!-- -->75<!-- -->[rpm]<!-- --> = 75<!-- -->*<!-- -->((85<!-- -->*<!-- -->8)/60) = 850<!-- -->[pulse/s]<!-- --> -&gt; 1펄스 시간 = 1/850 = 0.0012<!-- -->[s]<br>
<!-- -->15<!-- -->[rpm]<!-- --> = 15<!-- -->*<!-- -->((85<!-- -->*<!-- -->8)/60) = 170<!-- -->[pulse/s]<!-- --> -&gt; 1펄스 시간 = 1/170 = 0.0059<!-- -->[s]<br>
<!-- -->1<!-- -->[rpm]<!-- --> = 1<!-- -->*<!-- -->((85<!-- -->*<!-- -->8)/60) = 11.333<!-- -->[pulse/s]<!-- --> -&gt; 1펄스 시간 = 1/11.333 = 0.0882<!-- -->[s]<!-- -->  </p><p>850<!-- -->[pulse/s]<!-- --> = 85<!-- -->[pulse/0.1s]<!-- --> = 8.5<!-- -->[puls/0.01s]<!-- --> = 0.85<!-- -->[pulse/s]</p><ul><li>60rpm을 기준으로 rpm -&gt; pulse/s로 단위환산을 수행한다.</li><li>15<!-- -->[rpm]<!-- -->은 4<!-- -->[s]<!-- -->동안 Gear 1회전하는 속도이다.</li></ul><center><table><thead><tr><th>Gear</th><th>Gear</th><th>Shaft</th><th>Shaft</th></tr></thead><tbody><tr><td>60<!-- -->[rpm]</td><td>1<!-- -->[rev/s]</td><td>85<!-- -->[rev/s]</td><td>680<!-- -->[pulse/s]<!-- --> (1rev=8pulse)</td></tr><tr><td>15<!-- -->[rpm]</td><td>0.25<!-- -->[rev/s]</td><td>21.25<!-- -->[rev/s]</td><td>170<!-- -->[pulse/s]</td></tr></tbody></table></center><p>60<!-- -->[rpm]<!-- --> x 85/60<!-- -->[(rev/s)/rpm]<!-- --> = 85<!-- -->[rev/s]<!-- -->
60<!-- -->[rpm]<!-- --> x (85*8)/60<!-- -->[(pluse/s)/rpm]<!-- --> = 680<!-- -->[pulse/s]</p><p>따라서
rpm에 <code>(85)/60</code>를 곱하면 <!-- -->[rev/s]<!-- -->가 되고,
rpm에 <code>(85*8)/60</code>를 곱하면 <!-- -->[pulse/s]<!-- -->가 된다.</p><ul><li>1<!-- -->[rpm]<!-- --> = (85)/60<!-- -->[rev/s]</li><li>1<!-- -->[rpm]<!-- --> = (85*8)/60<!-- -->[pulse/s]</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="period-측정을-통한-속도계산">Period 측정을 통한 속도계산<a class="hash-link" href="#period-측정을-통한-속도계산" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="manual-coding-방법---ext_int로-1펄스-시간을-측정해-속도계산"><u>Manual Coding 방법 - Ext_Int로 1펄스 시간을 측정해 속도계산</u><a class="hash-link" href="#manual-coding-방법---ext_int로-1펄스-시간을-측정해-속도계산" title="Direct link to heading">​</a></h4><p>외부인터럽트(Ext_Int)로 hall pulse(A상(or B상)rising edge)를 입력 받고, 인터럽트가 발생할 때마다 인터럽트 발생 시간(SysTick 카운트)을 저장하여 이전 인터럽트부터 현재 인터럽트 발생 시점까지 시간 dt를 계산한다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;--윈도우모터 1회전--&gt;     // 2펄스 -&gt; 1.0[rev]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;--dt_A---&gt;             // 1펄스 -&gt; 0.5[rev]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ↓         ↓</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A상  |￣￣|____|￣￣|____</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">B상     |￣￣|____|￣￣|____</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       ↑         ↑</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       &lt;--dt_B---&gt;          // 1펄스 -&gt; 0.5[rev]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* 속도 = 거리/시간 = 0.5[rev]/dt[s] = 0.5/dt [rev/s]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* 1[rev/s] = 60[rpm] -&gt; (0.5/dt)*60 [rpm]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>노이즈로 인해 속도가 튀는 경우가 가끔 발생하므로 속도 업데이트 시점에 dt_A와 dt_B의 차이가 작은 경우에만 속도를 업데이트 하고, 차이가 클 경우 이전 속도로 값을 유지시킨다. (속도가 변하므로 같을 수는 없음)</li><li>그래도 가끔씩 이동중 Zero Velocity가 나오는 경우가 있음 -&gt; 이전위치와 현재위치가 다를 경우 이동중이므로 Zero Velocity가 나오면 이전 속도로 값을 유지시킨다.</li></ul><p align="center"><img loading="lazy" src="/webpage/assets/images/mbd_sys_mil_f0_modeling_0_vel_process-dadc2ed6717f16163702812c7d2c08be.png" alt="Example banner" width="350" class="img_ev3q"><br><em>&lt;속도 정확도 향상처리 방법&gt;</em></p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">PORTB_IRQHandler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">PORTB</span><span class="token operator">-&gt;</span><span class="token plain">ISFR </span><span class="token operator">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// A상 인터럽트</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">PTB</span><span class="token operator">-&gt;</span><span class="token plain">PDIR </span><span class="token operator">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// 입력 high -&gt; rising edge</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)">// dt_A 측정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            gw_curr_pb2_tick </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">int32_t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token function" style="color:rgb(80, 250, 123)">osif_GetCurrentTickCount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            gw_elapse_tick </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">gw_curr_pb2_tick </span><span class="token operator">&gt;=</span><span class="token plain"> gw_prev_tick</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">gw_curr_pb2_tick </span><span class="token operator">-</span><span class="token plain"> gw_prev_tick</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">gw_curr_pb2_tick </span><span class="token operator">+</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0xFFFFFFFFu</span><span class="token operator">-</span><span class="token plain">gw_prev_tick</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            gw_prev_tick </span><span class="token operator">=</span><span class="token plain"> gw_curr_pb2_tick</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain">                      </span><span class="token comment" style="color:rgb(98, 114, 164)">// 입력 low -&gt; falling edge</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">PORTB</span><span class="token operator">-&gt;</span><span class="token plain">ISFR </span><span class="token operator">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">PTB</span><span class="token operator">-&gt;</span><span class="token plain">PDIR </span><span class="token operator">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)">//A상 rising와 동일한 방법으로 B상 rising dt_B 측정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">abs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dt_A</span><span class="token operator">-</span><span class="token plain">dt_B</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token operator">&lt;</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// Update velocity</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// maintain previous velocity</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Zero Velocity 측정</h5></div><div class="admonition-content"><p>인터럽트를 통해 1펄스를 입력받아 속도를 측정하는 경우, 모터정지 시 인터럽트가 발생하지 않기 때문에 속도가 0으로 업데이트 되지 않는 문제를 해결해야 한다.  </p><ul><li>현재(21.09.16) 다음과 같이 구현<ul><li>일정 시간 위치값의 변화가 없으면 속도를 0으로 업데이트</li><li>측정결과 max low velocity에서 최대 260ms 간격으로 1펄스가 발생할 수 있다.</li></ul></li><li>문제<ul><li>0속도 판단에 300ms 가 소요됨</li></ul></li></ul></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="input_capture로-1펄스-시간을-측정해-속도-계산---simulink-autocode-방법-적용"><u>Input_Capture로 1펄스 시간을 측정해 속도 계산 - Simulink AutoCode 방법 적용</u><a class="hash-link" href="#input_capture로-1펄스-시간을-측정해-속도-계산---simulink-autocode-방법-적용" title="Direct link to heading">​</a></h4><ul><li>Simulink S32K144 Capture Input Block을 통해 생성된 코드를 실행하여 펄스 Period를 측정할 경우 계산된 속도값이 가끔 튀는 현상이 발생한다.<ul><li>측정속도가 튀니까 이를 제어하려고 모터가 꿀렁임, 시뮬링크 자동생성 코드 효율이 좋치 않아서 튀는게 아닌지 의심스러움(21.11.17)</li><li>Input Capture를 통해 속도를 측정할 때 형변환을 수행하는데, 불필요한 형변환을 제거하니까 다시 잘됨(21.11.19)</li></ul></li><li>Manual Coding으로 ExtInt로 펄스 Period를 측정할 경우 튀는 현상없이 잘됨.<ul><li>Simulink S32k144 ExtInt를 구현해서 ExtInt를 통해 속도를 측정해 보고 그래도 속도가 가끔 튀는 현상이 지속되면 기존에 구현해 놓은 Manual Coding으로 ExtInt를 구현한 방법 사용할 것(21.11.17)</li><li>구현상 문제를 해결하니까 잘 되므로 그냥 Simulink AutoCode 방법을 사용하기로 함(21.11.19)</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="측정값-필터링"><u>측정값 필터링</u><a class="hash-link" href="#측정값-필터링" title="Direct link to heading">​</a></h3><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</h5></div><div class="admonition-content"><ul><li>필터링 필요성<br>본 프로젝트에서는 1펄스 주기를 이용하여 속도를 계산하는데, 필터를 추가하지 않으면 노이즈로 인하여 측정된 속도가 튀는 현상이 발생되고, 이로인해 모터출력도 꿀렁임</li><li>HW필터링<br>Capture Input 모듈이 제공하는 Hardware Level의 Filter 적용(디지털 필터 없이 이것만 적용해서 깔끔하게 속도가 측정되는 것을 확인함, 21.10.29)<br><del>디지털필터를 적용하면 튀는값은 잡울 수 있느나 피드백 값 업데이트가 느려져서 속도제어가 빨리빨리 되지 않는 듯한 느낌이 있음 (21.11.15 재확인필요)</del></li><li>SW필터링(필요성)<br>Input Capture 분해능때문에 저속 속도측정이 불가능한하며, 이로인해 0<!-- -->[Rpm]<!-- -->에서 속도측정이 가능한 구간으로 확 올라가거나, 이동하다 정지할 경우 인위적으로 0<!-- -->[Rpm]<!-- -->으로 만들기 때문에 과도구간에서 급격한 속도변화가 발생한다.<br>-&gt; 이를 방지하기 위해 LPF를 적용한다.</li></ul></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="하드웨어필터input-capture-filter-설계">하드웨어필터(Input Capture filter) 설계<a class="hash-link" href="#하드웨어필터input-capture-filter-설계" title="Direct link to heading">​</a></h4><ul><li>HW 필터 적용<br>s32k144 Capture Input simulink block에 해당하는 <code>FTM Input Edge Capture</code> 더블클릭 → General탭 → Check <code>Filter enable</code> → <code>Input Filter value</code>를 3으로 설정하고 측정하니까 소프트웨어 필터 없이도 속도측정값 튀지않고 잘 측정됨(21.10.29)</li><li>High Priority로 우선순위 설정<br>우선순위를 높게 설정하지 않으면 우선순위가 높은 ISR이 수행되어 속도측정이 튀는 현상이 발생하므로 우선순위를 가장 높게(0) 설정한다.</li><li>해상도<br>저속에서 펄스폭이 길어지는데, Prescale Factor를 가장 높게(128) 설정하여 저속 펄스를 최대한 측정할 수 있도록 설정한다.</li><li>Edge 측정<br>rising edge만 측정하여 1펄스 발생 시간을 측정한다.
Velocity = 0.5회전/1펄스측정시간 = pi/dt
(2극의 경우 모터 shaft 1회전 시 2펄스 발생)</li></ul><p align="center"><img loading="lazy" src="/webpage/assets/images/mbd_sys_mil_f0_modeling_1_IC_hw_filter-76b51092516117ace11cae781d5def01.png" alt="Example banner" width="350" class="img_ev3q"><br><em>&lt;Input Capture HW 필터 설정&gt;</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="디지털필터lpf-설계">디지털필터(LPF) 설계<a class="hash-link" href="#디지털필터lpf-설계" title="Direct link to heading">​</a></h4><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>기능구현 완료 후 필터설계를 진행하고, 우선 간단하게 속도측정 시 다음과 같이 Low Pass Filter를 적용한다(21.09.27)
LPF</p></div></div><p>저역통과필터는 입력신호와 직렬로 R을 연결하고, 병렬로 C를 연결하며, RC를 이용하여 차단주파수가 결정된다.<br>
<!-- -->Cut off frequency Fc = 1/(2<!-- -->*<!-- -->pi<!-- -->*<!-- -->RC)<br>
<!-- -->Fc=1로 설정하여 1Hz보다 주파수가 높은 신호를 차단할 경우 RC값은<br>
<!-- -->RC = 1/(2<!-- -->*<!-- -->pi<!-- -->*<!-- -->Fc) = 1/(2<!-- -->*<!-- -->pi<!-- -->*<!-- -->1) = 0.1592가 되고,<br>
<!-- -->Lowpass Filter 전달함수는 Vo/Vi = 1/(1+jw<!-- -->*<!-- -->RC) = 1/(1+RC<!-- -->*<!-- -->s)이므로<br>
<!-- -->전달함수는 H = Vo/Vi = 1/(0.1592<!-- -->*<!-- -->s+1)이 된다.</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">fc</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">                         </span><span class="token comment" style="color:rgb(98, 114, 164)">// 1Hz보다 높은 주파수 차단</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RC</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token operator">*</span><span class="token plain">pi</span><span class="token operator">*</span><span class="token plain">fc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Hs </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">tf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">RC </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)">// LPF 전달함수</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Hs </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token number">0.1592</span><span class="token plain"> s </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Hz </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">c2d</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Hs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0.001</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token char" style="color:rgb(255, 121, 198)">&#x27;tustin&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// 샘플링 주기 : 1ms</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Hz </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token number">0.003132</span><span class="token plain"> z </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">0.003132</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       z </span><span class="token operator">-</span><span class="token plain"> </span><span class="token number">0.9937</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>2pi<!-- -->[rad/s]<!-- -->가 1<!-- -->[Hz]<!-- -->이므로 rad/s에 2pi를 곱하면 Hz가 된다. 즉, 100*(2pi)=100Hz가 된다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">1[Hz]:2pi[rad/s] = freq_in[Hz]:freq_out[rad/s]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">freq_out = freq_in*2pi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>속도측정 시 다음과 같은 LPF(fc=1Hz) 및 Butterworth Filter(fc=6Hz)를 적용한다.</p><p align="center"><img loading="lazy" src="/webpage/assets/images/mbd_sys_mil_f0_modeling_2_LPFnButterworth-53b5b6d417d3582a4e040f8cc6778d97.png" alt="Example banner" width="350" class="img_ev3q"><br><em>&lt;1차 (좌) LPF fc=1Hz, Ts=0.001s vs (우) Butterworth fc=6Hz&gt;</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="디지털필터fir-설계">디지털필터(FIR) 설계<a class="hash-link" href="#디지털필터fir-설계" title="Direct link to heading">​</a></h4><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>[Html Link]</h5></div><div class="admonition-content"><a target="_blank" href="/webpage/assets/kalman/fir_filtering.html">1. FIR Lowpass filter를 통한 속도측정</a><br></div></div><ul><li>LPF로 필터링 잘 안될 경우 CMSIS DSP Library FIR Low Pass Filter example.mp4 - CMSIS에서 제공하는 필터 라이브러리 이용하는 방법 고려해 볼 것  <ul><li><a href="https://www.keil.com/pack/doc/CMSIS/DSP/html/group__FIRLPF.html" target="_blank" rel="noopener noreferrer">FIR Lowpass Filter Example</a></li><li><a href="https://www.keil.com/pack/doc/CMSIS/DSP/html/arm_fir_example_f32_8c-example.html" target="_blank" rel="noopener noreferrer">예제소스 arm_fir_example_f32.c</a></li></ul></li><li>nxp에서 제공 AMMCLIM f라이브러리를 이용하는 방법 고려해 볼 것<ul><li>s32k14x시뮬링크 예제 - ../S32K14x_AMMCLIB_v1.1.18/../GDFLIB_FilterFIR_BAM_F32.mdl</li></ul></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="디지털필터-타겟보드-동작확인">디지털필터 타겟보드 동작확인<a class="hash-link" href="#디지털필터-타겟보드-동작확인" title="Direct link to heading">​</a></h4><p>시뮬링크 모델 <a href="#dc%EB%AA%A8%ED%84%B0-%EC%9C%84%EC%B9%98%EC%86%8D%EB%8F%84-%EC%B8%A1%EC%A0%95">nxp_s32k144_gpio_pwm_adc_qd_ic.slx</a>을 코드자동생성/빌드/다운로드 하여 실행하면, FreeMASTER를 통해 다음과 같은 필터링 결과를 확인할 수가 있다.</p><p align="center"><img loading="lazy" src="/webpage/assets/images/mbd_sys_mil_f0_modeling_3_LPF_targetExecution-f1c6b259cd130e4dcd640628c5a761c5.png" alt="Example banner" width="350" class="img_ev3q"><br><em>&lt;LPF를 통한 저속구간 속도 필터링 필요성&gt;</em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pulse-count를-통한-속도계산">Pulse Count를 통한 속도계산<a class="hash-link" href="#pulse-count를-통한-속도계산" title="Direct link to heading">​</a></h3><ul><li>1회전 당 8카운트가 발생하므로<ul><li>1<!-- -->[rev]<!-- -->=8<!-- -->[pulsecnt]<!-- --> -&gt; 1<!-- -->[pulsecnt]<!-- --> = 1/8<!-- -->[rev]</li><li>따라서 발생한 pulsecnt를 8로 나누면 <!-- -->[rev]<!-- -->가 된다.</li></ul></li><li>1ms마다 인터럽트를 발생시켜 증가한 펄스수를 확인하는 경우<ul><li><code>속도 = 거리 / 시간</code><br>-&gt; (pulsecnt/8)<!-- -->[rev]<!-- -->/0.001<!-- -->[s]<!-- --> = (1000/8)<!-- -->*<!-- -->pulsecnt <!-- -->[rev/s]</li></ul></li><li>[rev/s]<!-- --> -&gt; <!-- -->[rpm]<!-- --> 변환<ul><li>1<!-- -->[rev/s]<!-- -->=60<!-- -->[rpm]</li><li>60<!-- -->*<!-- -->(1000/8)<!-- -->*<!-- -->pulsecnt <!-- -->[rpm]</li></ul></li></ul><p>윈도우모터의 경우 저속에서 1펄스(0.5<!-- -->[rev]<!-- -->)가 발생하는 시간은 260ms(duty 7.6%)가 되므로
1ms 간격으로 펄스카운트 측정 시 속도측정이 불가능 하다.<br>
<!-- -->이를 해결하기 위해 샘플시간을을 1ms에서 1s(or 100ms)로 늘리면 펄스카운트가 가능하여 속도측정이 가능하지만 속도 업데이트가 1s(or 100ms)로 느려지므로 고속제어 시에는 적용이 불가능하다.</p><p align="center"><img loading="lazy" src="/webpage/assets/images/mbd_sys_mil_f0_modeling_4_vel_measure-b78f2082b30c638e631c2858c4cf398a.png" alt="Example banner" width="350" class="img_ev3q"><br><em>&lt;PWM출력 vs 속도측정(1펄스시간/주기동안펄스카운트)&gt;</em></p><font color="#34a28a">따라서 펄스카운트 개수를 통한 속도계산은 엔코더 분해능이 높거나 고속에서 속도측정 시 사용되어야 한다.</font><br><br><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>1ms로 피드백제어를 수행할 때 100ms 속도가 업데이트 되는 경우 제어가 불가능함</p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/main/website/docs/3_sideprj/2_window/window_realize_f0_VelMeasure.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vbeJ"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/webpage/docs/sideprj/window/window_realize_f0_PlantModeling"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">플랜트모델링</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/webpage/docs/sideprj/window/window_realize_f1_AutoManual"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">F1 AutoManual</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#속도측정" class="table-of-contents__link toc-highlight">속도측정</a><ul><li><a href="#dc모터-위치속도-측정-방법" class="table-of-contents__link toc-highlight">DC모터 위치/속도 측정 방법</a></li><li><a href="#period-측정을-통한-속도계산" class="table-of-contents__link toc-highlight">Period 측정을 통한 속도계산</a></li><li><a href="#측정값-필터링" class="table-of-contents__link toc-highlight"><u>측정값 필터링</u></a></li><li><a href="#pulse-count를-통한-속도계산" class="table-of-contents__link toc-highlight">Pulse Count를 통한 속도계산</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/webpage/docs/mycareer">경력요약</a></li><li class="footer__item"><a class="footer__link-item" href="/webpage/docs/introduce">자기소개</a></li><li class="footer__item"><a class="footer__link-item" href="/webpage/docs/sideprj">사이드프로젝트</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/webpage/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/chuldongshim/webpage" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/webpage/assets/js/runtime~main.17ca84bd.js"></script>
<script src="/webpage/assets/js/main.112632cd.js"></script>
</body>
</html>